# ADR 2026-01-14 — infra層のインターフェースと実装の分離

## 背景

- PR #30でinfra層の境界を実装し、Issue #33でESLintルールを強化したが、infra層内部で「公開API」と「実装詳細」が同じディレクトリレベルに混在している。
- 現状は `import/no-restricted-paths` でのみ制限を強制しており、ディレクトリ構造から設計意図が読み取りにくい。
- フロントエンドにおける「infra層」や「腐敗防止層」は業界標準のプラクティスではないが、本プロジェクトでは以下の理由で妥当と判断した：
  - 複数のデータソース切り替え（LocalStorage ↔ Supabase、Google Sheets連携）
  - AI駆動開発において境界が明確であることの価値
  - ESLintで機械的に強制可能

## 決定

1. **`api/` と `impl/` でディレクトリを分離する**
   - `infra/api/`: features層から参照可能な公開インターフェース
   - `infra/impl/`: infra層内部でのみ参照可能な実装詳細
   - クリーンアーキテクチャの `ports/adapters` も検討したが、本プロジェクトの規模に対してオーバーキルと判断

2. **ESLintルールで境界を強制する**
   - `features/` → `infra/impl/` への直接アクセスを禁止
   - `features/` → `infra/api/` のみ許可
   - infra層内部（`impl/` から `impl/`、`api/` から `impl/`）は自由に参照可能

3. **既存のaliasは維持する**
   - `@infra/auth`, `@infra/config` 等のaliasはそのまま利用可能
   - 内部実装の移動は利用側に影響しない

## 影響

- 既存の `infra/` 配下のファイルは `api/` または `impl/` に再配置される。
- ESLintルールの更新により、誤って実装詳細に依存するコードがCI段階で検出される。
- 新規のinfraモジュール追加時は、公開APIを `api/` に、実装を `impl/` に配置するルールが明文化される。

## メモ

- `api/` 配下には `index.ts`（バレルファイル）のみを配置し、実際の実装コードは `impl/` に置く。
- `google/` や `supabase/` のような外部サービス固有の実装は `impl/` に閉じ込め、features層は `repository/` 経由でアクセスする既存パターンを維持。
- 本決定はフロントエンド業界の標準プラクティスではなく、本プロジェクト固有の複雑性（複数データソース、AI駆動開発）に対する選択である。
