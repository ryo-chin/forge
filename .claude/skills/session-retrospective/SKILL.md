---
name: session-retrospective
description: |
  セッション終了時の振り返りを実施し、失敗をガードレール（司法）に変換する。
  AI駆動開発の生産性100xを実現するための改善サイクルを回す。
  使用タイミング: (1) セッション終了時、(2) 「振り返り」「retrospective」と言われた時、
  (3) 実装完了後に改善点を洗い出したい時、(4) 同じ失敗を繰り返したくない時
---

# Session Retrospective

セッションの失敗を分析し、ガードレールに変換する。

## ワークフロー（インタラクティブ）

**重要**: 各ステップでAskUserQuestion toolを使い、ユーザーの回答を待ってから次に進む。

### Step 1: 失敗の特定

セッションを分析し、発生した問題を抽出する。

以下のカテゴリで問題を探す:
- **質問ラウンドトリップ**: 何回の質問サイクルがあったか？
- **スコープ膨張**: 当初の要件から拡大したか？
- **手戻り**: 実装後に方向転換が必要だったか？
- **コンテキスト混同**: 古い情報や不要な情報で混乱したか？
- **ドキュメント乖離**: ドキュメントとコードが一致していたか？

抽出後、AskUserQuestionで確認:

```
header: "問題の確認"
question: "以下の問題を特定しました。見落としや追加はありますか？"
options:
  - label: "この内容でOK"
  - label: "追加がある"
  - label: "修正が必要"
```

### Step 2: 問題ごとのガードレール変換

特定した問題を1つずつ処理する。各問題について:

1. 原因を分析（Issue不足？ガードレール不足？）
2. 変換先を提案
3. AskUserQuestionで確認

```
header: "変換: [問題名]"
question: "[問題の説明] → どう変換しますか？"
options:
  - label: "[提案1: ESLintルール追加]"
  - label: "[提案2: CLAUDE.mdにルール追加]"
  - label: "[提案3: Issue作成のみ]"
  - label: "対応不要（低頻度）"
```

### Step 3: アクション実行

承認されたガードレール変換を1つずつ実行。

各アクション完了後、AskUserQuestionで次を確認:

```
header: "次のアクション"
question: "[完了したアクション]が完了。次は？"
options:
  - label: "[次のアクション名]を実行"
  - label: "残りは後で対応"
  - label: "完了（振り返り終了）"
```

## 変換パターン

詳細は [ai-driven-dev-principles.md](references/ai-driven-dev-principles.md) 参照。

| 優先度 | 種別 | 例 |
|-------|------|---|
| 1 | ESLint/Biome/CI | 相対パス禁止 → no-restricted-imports |
| 2 | Issueテンプレート | 選択肢未決定 → 「選択済みアプローチ」セクション |
| 3 | CLAUDE.md/rules | スコープ膨張 → 「1 Issue = 1変更」ルール |
| 4 | スコア判定（LLM） | 命名一貫性 → LLMレビューでチェック |

## 原則

- **失敗は必ず司法に変換する**
- **推奨より禁止から作る**
- **0/1判定を優先、スコア判定は最後の手段**
- **1問1答でインタラクティブに進める**
