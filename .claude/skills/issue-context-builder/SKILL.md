---
name: issue-context-builder
description: |
  ユーザーの曖昧な要望・意図から、AIが自律実装可能な精度の高いIssueを構築する。
  使用タイミング: (1) 「Issue作って」「Issue化して」と言われた時、
  (2) 既存Issueのコンテキストを強化したい時、(3) 曖昧な要望を具体化したい時、
  (4) Sub Agentが自律実装できるIssueを準備したい時
---

# Issue Context Builder

曖昧な要望から、AIが自律実装可能な精度の高いIssueを構築する。

## 原則（参照: [ai-driven-principles.md](references/ai-driven-principles.md)）

- **Issueの質 = アウトプットの質**
- **過度なコンテキストは混同を招く**（過去の経緯、ボツ案は入れない）
- **「解決したい問題」「機能」「制約/前提条件」を明確に**

## ワークフロー

**重要**: 各ステップでAskUserQuestion toolを使い、ユーザーの回答を待ってから次に進む。

### Step 1: 入力の分類

ユーザーの入力を分類する:

| 入力タイプ | 例 | 次のステップ |
|-----------|---|-------------|
| 曖昧な要望 | 「ログインを安全にしたい」 | Step 2へ |
| Issue番号 | 「#34のコンテキスト強化」 | Issueを読んでStep 3へ |
| 具体的な機能要求 | 「JWT認証を追加」 | Step 3へ |

### Step 2: 要望の具体化

曖昧な要望の場合、AskUserQuestionで具体化する:

```
header: "目的の確認"
question: "[要望]について、具体的に何を解決したいですか？"
options:
  - label: "[推測される具体的な問題1]"
  - label: "[推測される具体的な問題2]"
  - label: "[推測される具体的な問題3]"
```

### Step 3: コンテキスト収集

以下を自動で収集する:

1. **関連ファイル**: Glob/Grepで関連コードを探索
2. **既存パターン**: 類似機能の実装パターンを特定
3. **適用ガードレール**: ESLint、型定義、テスト要件を確認
4. **依存関係**: 影響を受けるモジュールを特定

収集後、AskUserQuestionで確認:

```
header: "コンテキスト確認"
question: "以下のコンテキストで合っていますか？"
options:
  - label: "この内容でOK"
  - label: "追加情報がある"
  - label: "修正が必要"
```

### Step 4: Issue構造化

以下の形式でIssue本文を生成:

```markdown
## 解決したい問題

[1-2文で問題を明確に記述]

## 機能（期待する状態）

[実装後の状態を箇条書き]

## 制約/前提条件

- [ ] [ガードレール1: ESLintルール等]
- [ ] [ガードレール2: 型定義等]
- [ ] [ガードレール3: テスト要件等]

## 関連ファイル

- `path/to/file1.ts`: [役割]
- `path/to/file2.ts`: [役割]

## 実装ヒント

[AIが参考にすべきパターンや注意点]
```

### Step 5: 確認とIssue作成

生成したIssue本文を表示し、AskUserQuestionで確認:

```
header: "Issue作成"
question: "このIssueを作成しますか？"
options:
  - label: "作成する"
  - label: "修正してから作成"
  - label: "キャンセル"
```

「作成する」の場合、`gh issue create`でIssueを作成。

## アンチパターン（避けるべきこと）

- 過去の議論・経緯を詰め込む
- ボツになった案を含める
- 曖昧な表現のまま残す
- 関連ファイルを特定せずに進める
